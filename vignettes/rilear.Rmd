---
title: "rilear: Lifetime Excess Absolute Risk"
output: rmarkdown::html_vignette
description: >
  Show how rilear can be used to calculate lifetime
  excess absolute risk measures based on ERR / EAR
  radiation risk models.
vignette: >
  %\VignetteIndexEntry{rilear: Lifetime Excess Absolute Risk}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(collapse=TRUE, comment="#")
```

```{r}
library(rilear)
```

# Included risk models

  - `rm_solid_incid_walsh2021()`: Solid cancer incidence from Walsh et al. 2021
  - `rm_breast_incid_walsh2021()`: Breast cancer incidence from Walsh et al. 2021
  - `rm_leuk_incid_walsh2021()`: Leukemia / lymphoma incidence from Walsh et al. 2021
  - `rm_solid_incid_sumray()`: Solid cancer incidence from Sasaki et al. 2023
  - `rm_solid_mort_sumray()`: Solid cancer mortality from Sasaki et al. 2023

# Included cancer rates

All stratified by sex, age group. Interpolated for individual years of age.

## Incidence

  - `d_cancer_ger_incid_solidW_i`: Solid cancer incidence Germany 2023 - excluding C44 ([RKI](https://www.krebsdaten.de/))
  - `d_cancer_ger_incid_solid_c44W_i`: Solid cancer incidence Germany 2023 - including C44 ([RKI](https://www.krebsdaten.de/))
  - `d_cancer_ger_incid_breastW_i`: Breast cancer incidence Germany 2023 ([RKI](https://www.krebsdaten.de/))
  - `d_cancer_ger_incid_leuk_lymphW_i`: Leukemia / lymphoma incidence Germany 2023 - including CLL (C91.1, C91.4) / ATL (C91.5)([RKI](https://www.krebsdaten.de/))

## Mortality

  - `d_cancer_ger_mort_solidW_i`: Solid cancer mortality Germany 2024 - excluding C44 ([RKI](https://www.krebsdaten.de/))
  - `d_cancer_ger_mort_breastW_i`: Breast cancer mortality Germany 2024 ([RKI](https://www.krebsdaten.de/))
  - `d_cancer_ger_mort_leuk_lymphW_i`: Leukemia / lymphoma mortality Germany 2024 - including CLL (C91.1, C91.4) / ATL (C91.5) ([RKI](https://www.krebsdaten.de/))

# Included population data

All stratified by sex, age group.

## Population

  - `d_pop_ger_country_2024L`: Population Germany 2024 ([destatis](https://www-genesis.destatis.de/))
  - `d_pop_ger_fedstate_2024L`: Population Germany federal states 2024 ([destatis](https://www.regionalstatistik.de/))
  - `d_pop_ger_district_2024L`: Population Germany districts 2024 ([destatis](https://www.regionalstatistik.de/))

## Mortality rates

Interpolated for individual years of age.

  - `d_mort_rate_ger_country_2024W_i`: Mortality rates Germany 2024 ([destatis](https://www-genesis.destatis.de/))
  - `d_mort_rate_ger_fedstate_2017W_i`: Mortality rates Germany federal states 2017 ([destatis](https://www.regionalstatistik.de/))
  - `d_mort_rate_ger_district_2017W_i`: Mortality rates Germany districts 2017 ([destatis](https://www.regionalstatistik.de/))

# Lifetime excess absolute risk
## Single exposed person
### Without uncertainty

```{r}
## ERR / EAR risk models for solid cancer incidence and mortality
rm_incid <- rm_solid_incid_walsh2021()
rm_mort  <- rm_solid_mort_sumray()

## single point estimate after two exposures at age 20, 21
get_elr1(l_param=list(exposure      =list(dose=c(0.5, 0.7),
                                          agex=c(20, 21)),
                      param_err     =rm_incid$err$param,
                      param_ear     =rm_incid$ear$param,
                      param_err_mort=rm_mort$err$param,
                      param_ear_mort=rm_mort$ear$param,
                      wt_transfer   =c(ERR=0.5, EAR=0.5),
                      ddref         =1,
                      lat_t0        =5,
                      lat_eta       =6.25),
         sex               ="f",
         risk_model        =rm_incid,
         risk_model_mort   =rm_mort,
         d_base_cancer     =d_cancer_ger_incid_solidW_i,
         d_base_cancer_mort=d_cancer_ger_mort_solidW_i,
         d_base_mort       =d_lifetable_ger_2024W,
         age_max           =95,
         lat_method        ="ProZES",
         metric            =c("LEAR", "RADS"))
```

### With uncertainty

```{r}
## ERR / EAR risk models for solid cancer incidence and mortality
rm_incid <- rm_solid_incid_walsh2021()
rm_mort  <- rm_solid_mort_sumray()

## generate list of 2 exposure events
expo_event <- gen_exposure(n    =2,
                           agex =c(20, 21),
                           distr=c("normal", "triangular"),
                           param=list(c(mean=0.5, sd=0.05),
                                      c(mode=0.5, min=0.1, max=0.6)))

get_elr1_mc(## parameters with uncertainty
            exposure          =expo_event,
            wt_transfer       =c(ERR=0.5, EAR=0.5),
            wt_transfer_fixed =FALSE,
            ddref             =1,
            ddref_fixed       =TRUE,
            lat_t0            =5,
            lat_eta           =6.25,
            lat_method        ="ProZES",
            lat_fixed         =FALSE,
            ## parameters without uncertainty
            sex               ="f",
            risk_model        =rm_incid,
            risk_model_mort   =rm_mort,
            d_base_cancer     =d_cancer_ger_incid_solidW_i,
            d_base_cancer_mort=d_cancer_ger_mort_solidW_i,
            d_base_mort       =d_lifetable_ger_2024W,
            alpha             =0.05,
            age_max           =95,
            metric            ="REIC",
            n_sim             =100L,
            multicore         =FALSE,
            n_cores_max       =10L,
            n_cores_omit      =2L,
            aggr_mc           =TRUE)
```

## Whole exposed population

```{r}
## ERR / EAR risk models for solid cancer incidence and mortality
rm_incid <- rm_solid_incid_walsh2021()
rm_mort  <- rm_solid_mort_sumray()

## generate list of 2 exposure events in consecutive years
expo_event <- gen_exposure(n     =2,
                           timing=c(0, 1),
                           distr =c("normal", "triangular"),
                           param =list(c(mean=0.5, sd=0.05),
                                       c(mode=0.5, min=0.1, max=0.6)))

## risk estimates for exposure of the population of Germany
get_elr_pop(d_pop_ger_country_2024L,
            exposure          =expo_event,
            wt_transfer       =c(ERR=0.5, EAR=0.5),
            wt_transfer_fixed =FALSE,
            ddref             =1,
            ddref_fixed       =TRUE,
            lat_t0            =5,
            lat_eta           =6.67,
            lat_method        ="ProZES",
            lat_fixed         =FALSE,
            n_sim             =100L,
            ##
            risk_model        =rm_incid,
            risk_model_mort   =rm_mort,
            d_base_cancer     =d_cancer_ger_incid_solidW_i,
            d_base_cancer_mort=d_cancer_ger_mort_solidW_i,
            d_base_mort       =d_lifetable_ger_2024W,
            metric            ="LEAR",
            age_max           =95,
            ##
            multicore         =FALSE,
            n_cores_max       =10L,
            n_cores_omit      =2L,
            stratify_sex      =TRUE,
            pop_ref           =100000)
```

# Calculations

  - Sommer et al. Radiat Res 2025. DOI: 10.1667/RADE-24-00060.1
  - ProZES: Ulanowski et al. Radiat Environ Biophys 2020. DOI: 10.1007/s00411-020-00866-7
  - RadRAT: Berrington de Gonzalez et al. JRP 2012. DOI: 10.1088/0952-4746/32/3/205
  - Sasaki et al. J Radiat Prot Res 2023 DOI: 10.14407/jrpr.2022.00213
  - Walsh et al. Radiat Environ Biophys 2019. DOI: 10.1007/s00411-021-00910-0
  - LARisk: Lee et al. DOI: 10.32614/CRAN.package.LARisk
