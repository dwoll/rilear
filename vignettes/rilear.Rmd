---
title: "rilear: Lifetime Excess Absolute Risk"
output: rmarkdown::html_vignette
description: >
  Show how rilear can be used to calculate lifetime
  excess absolute risk measures based on ERR / EAR
  radiation risk models.
vignette: >
  %\VignetteIndexEntry{rilear: Lifetime Excess Absolute Risk}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(collapse=TRUE, comment="#")
```

```{r}
library(rilear)
```

# Included risk models

  - `rm_solid_incid_walsh2021()`: Solid cancer incidence from Walsh et al. 2021
  - `rm_breast_incid_walsh2021()`: Breast cancer incidence from Walsh et al. 2021
  - `rm_leuk_incid_walsh2021()`: Leukemia / lymphoma incidence from Walsh et al. 2021
  - `rm_solid_incid_sumray()`: Solid cancer incidence from Sasaki et al. 2023
  - `rm_solid_mort_sumray()`: Solid cancer mortality from Sasaki et al. 2023

# Included cancer rates

All stratified by sex, age group. Interpolated for individual years of age.

## Incidence

  - `d_cancer_ger_incid_solidW_i`: Solid cancer incidence Germany 2023 - excluding C44 ([RKI](https://www.krebsdaten.de/))
  - `d_cancer_ger_incid_solid_c44W_i`: Solid cancer incidence Germany 2023 - including C44 ([RKI](https://www.krebsdaten.de/))
  - `d_cancer_ger_incid_breastW_i`: Breast cancer incidence Germany 2023 ([RKI](https://www.krebsdaten.de/))
  - `d_cancer_ger_incid_leuk_lymphW_i`: Leukemia / lymphoma incidence Germany 2023 - including CLL (C91.1, C91.4) / ATL (C91.5)([RKI](https://www.krebsdaten.de/))

## Mortality

  - `d_cancer_ger_mort_solidW_i`: Solid cancer mortality Germany 2024 - excluding C44 ([RKI](https://www.krebsdaten.de/))
  - `d_cancer_ger_mort_breastW_i`: Breast cancer mortality Germany 2024 ([RKI](https://www.krebsdaten.de/))
  - `d_cancer_ger_mort_leuk_lymphW_i`: Leukemia / lymphoma mortality Germany 2024 - including CLL (C91.1, C91.4) / ATL (C91.5) ([RKI](https://www.krebsdaten.de/))

# Included population data

All stratified by sex, age group.

## Population

  - `d_pop_ger_country_2024L`: Population Germany 2024 ([destatis](https://www-genesis.destatis.de/))
  - `d_pop_ger_fedstate_2024L`: Population Germany federal states 2024 ([destatis](https://www.regionalstatistik.de/))
  - `d_pop_ger_district_2024L`: Population Germany districts 2024 ([destatis](https://www.regionalstatistik.de/))

## Mortality rates

Interpolated for individual years of age.

  - `d_mort_rate_ger_country_2024W_i`: Mortality rates Germany 2024 ([destatis](https://www-genesis.destatis.de/))
  - `d_mort_rate_ger_fedstate_2017W_i`: Mortality rates Germany federal states 2017 ([destatis](https://www.regionalstatistik.de/))
  - `d_mort_rate_ger_district_2017W_i`: Mortality rates Germany districts 2017 ([destatis](https://www.regionalstatistik.de/))

# Lifetime excess absolute risk
## Single exposed person
### Without uncertainty

```{r}
rm <- list(all_solid =rm_solid_incid_walsh2021(),
           breast    =rm_breast_incid_walsh2021(),
           leuk_lymph=rm_leuk_incid_walsh2021())

rm_mort <- list(all_solid =rm_solid_mort_sumray(),
                breast    =rm_breast_incid_walsh2021(),
                leuk_lymph=rm_leuk_incid_walsh2021())

base_cancer <- list(all_solid =d_cancer_ger_incid_solidW_i,
                    breast    =d_cancer_ger_incid_breastW_i,
                    leuk_lymph=d_cancer_ger_incid_leuk_lymphW_i)

base_cancer_mort <- list(all_solid =d_cancer_ger_mort_solidW_i,
                         breast    =d_cancer_ger_mort_breastW_i,
                         leuk_lymph=d_cancer_ger_mort_leuk_lymphW_i)

wt_transfer <- list(all_solid =c(ERR=0.5, EAR=0.5),
                    breast    =c(ERR=0.0, EAR=1.0),
                    leuk_lymph=c(ERR=1.0, EAR=0.0))

lat_t0 <- list(all_solid =4,
               breast    =4,
               leuk_lymph=1.5)

lat_eta <- list(all_solid =6.25,
                breast    =6.25,
                leuk_lymph=7.66)

expo_event <- gen_exposure(n          =2,
                           sex        ="f",
                           agex       =c(20, 21),
                           dose_distr =c("fixed", "normal"),
                           dose_param =list(0.5, c(mean=0.3, sd=0.05)),
                           ddref      =c(1, 1.5),
                           dose_rate  =c("acute", "acute"),
                           cancer_site=list("all_solid",
                                            c("all_solid", "leuk_lymph")))

p_mc <- gen_param_mc(exposure         =expo_event,
                     n_sim            =5L,
                     wt_transfer      =wt_transfer,
                     lat_t0           =lat_t0,
                     lat_eta          =lat_eta,
                     lat_method       ="ProZES",
                     lat_fixed        =FALSE,
                     wt_transfer_fixed=FALSE,
                     ddref_fixed      =FALSE,
                     risk_model       =rm,
                     risk_model_mort  =rm_mort)

get_lear_indiv(l_param         =p_mc[[1]],
               risk_model      =rm,
               risk_model_mort =rm_mort,
               base_cancer     =base_cancer,
               base_cancer_mort=base_cancer_mort,
               d_base_mort     =d_lifetable_ger_2024W,
               age_max         =90,
               lat_method      ="ProZES",
               metric          =c("LEAR", "RADS", "ELR"))
```

## Whole exposed population

```{r}
expo_event <- gen_exposure(n          =2,
                           sex        ="f",
                           timing     =1,
                           dose_distr =c("normal", "fixed"),
                           dose_param =list(c(mean=0.5, sd=0.015), 0.5),
                           ddref      =c(1, 1),
                           # dose_rate  ="acute",
                           cancer_site=list("all_solid",
                                            c("all_solid", "leuk_lymph")))

## generate sets of parameter settings
## with cancer mortality
rm <- list(all_solid =rm_solid_incid_walsh2021(),
           breast    =rm_breast_incid_walsh2021(),
           leuk_lymph=rm_leuk_incid_walsh2021())

base_cancer <- list(all_solid =d_cancer_ger_incid_solidW_i,
                    breast    =d_cancer_ger_incid_breastW_i,
                    leuk_lymph=d_cancer_ger_incid_leuk_lymphW_i)

wt_transfer <- list(all_solid =c(ERR=0.5, EAR=0.5),
                    breast    =c(ERR=0.0, EAR=1.0),
                    leuk_lymph=c(ERR=1.0, EAR=0.0))

lat_t0 <- list(all_solid =5,
               breast    =5,
               leuk_lymph=1.5)

lat_eta <- list(all_solid =6,
                breast    =6,
                leuk_lymph=6.75)

## solid cancer risk estimates
## for exposure of the population of Germany
get_lear_pop(x                =d_pop_ger_country_2024L,
             n_sim            =10L,
             exposure         =expo_event,
             wt_transfer      =wt_transfer,
             lat_t0           =lat_t0,
             lat_eta          =lat_eta,
             lat_method       ="ProZES",
             lat_fixed        =FALSE,
             wt_transfer_fixed=FALSE,
             ddref_fixed      =FALSE,
             risk_model       =rm,
             stratify_sex     =TRUE,
             pop_ref          =100000,
             alpha            =0.05,
             multicore        =FALSE,
             n_cores_max      =10L,
             n_cores_omit     =2L,
             base_cancer      =base_cancer,
             d_base_mort      =d_lifetable_ger_2024W,
             metric           =c("LEAR", "RADS"),
             age_max          =90)
```

# Calculations

  - Sommer et al. Radiat Res 2025. DOI: 10.1667/RADE-24-00060.1
  - ProZES: Ulanowski et al. Radiat Environ Biophys 2020. DOI: 10.1007/s00411-020-00866-7
  - RadRAT: Berrington de Gonzalez et al. JRP 2012. DOI: 10.1088/0952-4746/32/3/205
  - Sasaki et al. J Radiat Prot Res 2023 DOI: 10.14407/jrpr.2022.00213
  - Ulanowski et al. Radiat Environ Biophys 2019. DOI 10.1007/s00411-019-00794-1.
  - Walsh et al. Radiat Environ Biophys 2019. DOI: 10.1007/s00411-021-00910-0
  - LARisk: Lee et al. DOI: 10.32614/CRAN.package.LARisk
